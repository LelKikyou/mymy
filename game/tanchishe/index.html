<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>贪吃蛇</title>
</head>
<style>
    * {
        padding: 0;
        margin: 0;
    }

    ul {
        list-style: none;
    }

    #main {
        margin: 20px auto;
        position: relative;
    }

    .gird {
        border: 1px solid black;
        border-bottom: none;
        border-right: none;
        overflow: hidden;
    }

    .gird li {
        border-right: 1px solid black;
        border-bottom: 1px solid black;
        float: left;
    }

    .gameScore {
        float: right;
    }

    .snake {

    }

    .snake .snakeHead {
        position: absolute;
        background-color: red;
    }

    .snake .snakeBody {
        position: absolute;
        background-color: red;
        opacity: 0.5;
    }

    .food {
        position: absolute;
        background-color: blue;
        opacity: 0.8;
    }
</style>
<body>
<div id="main">
    <ul class="gird"></ul>
    <input type="button" value="开始" class="btn">
    <div class="gameScore">积分：<span>0</span></div>
    <div class="snake"></div>
</div>
</body>
<script>
    (function () {
        let main = document.querySelector('#main')
        let gird = document.querySelector('.gird');
        let girdData = {
            size: 20,
            cols: 25,
            rows: 25
        }
        let snakeData = {
            posLeft: 2,
            posTop: 2,
            sudu: 300,
            fangxiang: 39
        }
        let food;
        let snake;
        let snakeDiv;
        let li;
        let btn = document.querySelector('.btn')
        main.style.width = (girdData.size + 1) * girdData.cols + 1 + 'px';
        for (let i = 0; i < girdData.cols * girdData.rows; i++) {
            let li = document.createElement('li');
            li.style.width = girdData.size + 'px';
            li.style.height = girdData.size + 'px';
            gird.appendChild(li)
        }
        //开始游戏
        btn.focus();//自动获取光标
        btn.onclick = function () {
            createSnake()
        }
        //创建蛇
        function createSnake() {
            snake = document.querySelector('.snake');
            let snakeHead = document.createElement('div');
            snakeHead.className = 'snakeHead'
            snakeHead.style.width = snakeHead.style.height = girdData.size + 'px'
            snakeHead.style.top = (girdData.size + 1) * (snakeData.posTop - 1) + 1 + 'px'
            snakeHead.style.left = (girdData.size + 1) * (snakeData.posLeft - 1) + 1 + 'px'
            snake.appendChild(snakeHead)
            moveSnake()
            createFood()
            bindSnake()
        }

        function moveSnake() {
            setInterval(function () {
                snakeDiv = document.querySelectorAll('.snake div')
                //添加变长
                for (let i = snakeDiv.length - 1; i > 0; i--) {
                    snakeDiv[i].style.left = snakeDiv[i - 1].offsetLeft + 'px'
                    snakeDiv[i].style.top = snakeDiv[i - 1].offsetTop + 'px'
                }


                switch (snakeData.fangxiang) {
                    case 37:
                        snakeDiv[0].style.left = snakeDiv[0].offsetLeft - (girdData.size + 1) + 'px'
                        break;
                    case 38:
                        snakeDiv[0].style.top = snakeDiv[0].offsetTop - (girdData.size + 1) + 'px'
                        break;
                    case 39:
                        snakeDiv[0].style.left = snakeDiv[0].offsetLeft + (girdData.size + 1) + 'px'
                        break;
                    case 40:
                        snakeDiv[0].style.top = snakeDiv[0].offsetTop + (girdData.size + 1) + 'px'
                        break
                }
                console.log(snakeDiv)
                if(isOut()||isSelf()){
                    gameOver()
                }
                if (pz(snakeDiv[0], food)) {
                    food.class = '';
                    snake.appendChild(food)
                    food.className = 'snakeBody'
                    createFood()
                }

            }, snakeData.sudu)
        }

        //蛇的操作
        function bindSnake() {
            document.onkeydown = function (event) {
                switch (event.keyCode) {
                    case 37:
                        snakeData.fangxiang = 37;
                        break;
                    case 38:
                        snakeData.fangxiang = 38;
                        break;
                    case 39:
                        snakeData.fangxiang = 39;
                        break;
                    case 40:
                        snakeData.fangxiang = 40;
                        break;
                }
            }
        }

//       创建实物
        function createFood() {
            food = document.createElement('div');
            li = document.querySelectorAll('.gird li');
            let foodPos = Math.floor(Math.random() * li.length);
            food.className = 'food';
            food.style.width = food.style.height = girdData.size + 'px'
            food.style.top = li[foodPos].offsetTop + 'px'
            food.style.left = li[foodPos].offsetLeft + 'px'
            main.appendChild(food)
        }

        //是否出界
        function isOut() {
            for (let i = 0; i < li.length; i++) {
                if(pz(li[i],snakeDiv[0])){
                    return false
                }
            }
            return true
        }
        //是否碰到自身
        function isSelf() {
            for(let i=1;i<snakeDiv.length;i++){
                if(pz(snakeDiv[0],snakeDiv[i])){
                    return true
                }
            }
            return false
        }
        function gameOver() {
            alert('滚滚滚')
            location.reload()
        }
        //判断碰撞
        function pz(elem1, elem2) {
            let L1 = elem1.offsetLeft;
            let R1 = elem1.offsetLeft + elem1.offsetWidth;
            let T1 = elem1.offsetTop;
            let B1 = elem1.offsetTop + elem1.offsetHeight;

            let L2 = elem2.offsetLeft;
            let R2 = elem2.offsetLeft + elem2.offsetWidth;
            let T2 = elem2.offsetTop;
            let B2 = elem2.offsetTop + elem2.offsetHeight;

            if (R1 < L2 || L1 > R2 || B1 < T2 || T1 > B2) {
                return false
            } else {
                return true
            }
        }
    })()
</script>
</html>